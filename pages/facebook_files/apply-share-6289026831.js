Do("mod/ajax","lib/textarea-mention","mod/template","dui:overlay","ui/alert",function(){var c=Ark.ajax,b=function(d){d=d.clone();d.find("[data-id]").each(function(e,f){f=$(f);f.text("@"+f.data("id"))});return d.text()},a=function(f){var g=f.panel,e=g.find("textarea[name=text]"),d=g.find(".mention-highlighter"),h=g.find(".submit-share");if(!d.length){d=$("<div>",{"class":"mention-highlighter"});g.find(".share-text-wrapper").append(d)}h.submit(function(m){var j=h.attr("action"),i=$(this).serializeArray(),l={};$.each(i,function(o,p){l[p.name]=p.value});var n=b(d);if(n){l.text=n}var k=function(p){var o='<p class="dialog-shared-info">{{info}}</p>';return o.replace("{{info}}",p)};c.post(j,l,function(o){if(!o.error){return Ark.alert({content:k("分享成功"),timeout:2000})}Ark.alert({content:k(o.error)})});return false});e.textbox({itemCount:6,dataUrl:"https://api.douban.com/shuo/in/complete?alt=xd&amp;callback=?",listTmpl:$("#tmpl-mention").html(),highlighter:d})};$(document).on("click","a[rel=dialog][data-href]",function(d){d.preventDefault();Ark.applyDialog($(d.target),a)})});