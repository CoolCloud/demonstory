(function(d){var e=d.dui||{},g=$(window),k=$(document),a="#dui-overlay-container",h=['<div class="dui-overlay-mask" style="background:{{bgcolor}}"></div>','<div id="',a.replace("#",""),'" class="dui-overlay-container"></div>'].join(""),f=['<div class="dui-overlay-panel" style="width:{{width}}px">','<div class="hd">{{title}}{{bn-overlay-close}}</div>','<div class="bd">{{content}}</div>','<div class="ft">{{footer}}</div>',"</div>"].join(""),l="<h2>{{title}}</h2>",j='<a href="#" class="lnk-close">&times;</a>',i,c={width:600,bgColor:"#000",title:"",content:"",footer:""},b=function(m){this._eventStack={};this.setConfig(m);this.on("overlay:content_change",this.checkContentChange).on("overlay:init_end",this.checkContentChange).on("overlay:init_end",function(){this.panel.find(".lnk-close").click($.proxy(function(o){o.preventDefault();this.close()},this))});var n=this;g.resize(function(){n.checkContentChange()});k.on("click",function(o){if(o.target.className==="dui-overlay-container"){n.close()}})};b.prototype={fire:function(o,p){var m=this._eventStack[o];if(!m){return}for(var n in m){if(m.hasOwnProperty(n)){m[n].apply(this,$.isArray(p)?p:[p])}}},on:function(m,n){if(!this._eventStack[m]){this._eventStack[m]=[]}this._eventStack[m].push(n);return this},setConfig:function(m){this.config=$.extend(this.config||c,m);return this},setContent:function(n){var m=this;this.panel.find(".bd").html(n);setTimeout(function(){m.fire("overlay:content_change")},0);return this},render:function(){var n=this.config,m=f;if(this.hasRendered){this.panel.css("width",n.width+"px");if(n.title===""){this.panel.find(".hd h2").hide()}else{this.panel.find(".hd h2").show().text(n.title)}if(n.footer===""){this.panel.find(".ft").hide()}else{this.panel.find(".ft").show().html(n.footer)}this.setContent(n.content)}else{$("body").append(h.replace("{{bgcolor}}",n.bgColor));this.container=$(a);m=m.replace("{{title}}",l.replace("{{title}}",n.title)).replace("{{width}}",n.width).replace("{{content}}",n.content).replace("{{footer}}",n.footer).replace("{{bn-overlay-close}}",j);this.panel=$(m).appendTo(this.container);this.nodes=$(".dui-overlay-mask, .dui-overlay-container");this.fire("overlay:init_end")}this.hasRendered=1;this.fire("overlay:render_end");return this},show:function(){var m=$(g)[0].scrollY;$("html").css({height:"auto",overflowX:"hidden",overflowY:"hidden"});if(this.hasRendered){this.nodes.show()}else{this.render()}this.fire("overlay:show");if($.browser.mozilla){$(g)[0].scrollTo(0,m)}},close:function(){var m=$(g)[0].scrollY;$("html").css({height:"auto",overflowY:"auto"});this.nodes.hide();this.fire("overlay:close");if($.browser.mozilla){$(g)[0].scrollTo(0,m)}},checkContentChange:function(){if(!this.panel){return}var n=this.panel.height(),m=g.height();if(n>m){this.panel.css({position:"relative",margin:"50px auto",top:0,left:0})}else{this.panel.css({position:"absolute",top:m/2,left:"50%","margin-top":-1*n/2+"px","margin-bottom":0,"margin-left":-1*this.panel.width()/2+"px"})}}};e.overlay=function(m){if(!i){i=new b(m)}return i};d.dui=e})(window);