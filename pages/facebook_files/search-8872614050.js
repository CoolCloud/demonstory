(function(){$.suggests=function(i){var s=$(document.body),r=window._,k=$("#input-query"),c=$("#frm-search"),o=$("#suggest-list"),h=$("#tmpl-suggest-item").html(),u=k.val(),j={url:"",param:"q",width:360,selectClass:"suggest-item-hover",delay:200};i=$.extend({},j,i);function g(v){switch(v.keyCode){case 9:case 27:q();break;case 38:n();break;case 40:b();break;case 13:f();c.submit();break;default:return}v.stopImmediatePropagation();v.preventDefault()}function e(v){switch(v.keyCode){case 38:case 40:return}if(u!==k.val()){l()}}function d(){if(o.is(":hidden")){return false}var v=o.children("li."+i.selectClass);if(!v.length){v=false}return v}function f(){var v=d();if(v){k.val(v.html());q();k.blur()}}function b(){var v=d();if(v){v.removeClass(i.selectClass).next().addClass(i.selectClass)}else{o.children("li:first-child").addClass(i.selectClass)}}function n(){var v=d();if(v){v.removeClass(i.selectClass).prev().addClass(i.selectClass)}else{o.children("li:last-child").addClass(i.selectClass)}}function t(v){if(/27$|38$|40$/.test(v.keyCode)||/^13$|^9$/.test(v.keyCode)){return true}}function l(){u=k.val();if(u!==""){clearTimeout(this._queryRef);this._queryRef=setTimeout(function(){$.ajax({type:"GET",url:i.url,data:i.param+"="+encodeURIComponent(u),success:function(v){p(v)},dataType:"json"})},i.delay)}else{q()}}function a(){o.find("li").hover(function(){$(this).siblings("."+i.selectClass).removeClass(i.selectClass);$(this).addClass(i.selectClass)},function(){$(this).removeClass(i.selectClass)}).click(function(){f();c.submit()})}function m(w){o.html(w);var x=k.offset(),v=k.outerHeight();o.css("top",x.top+v);o.css("left",x.left);a();o.width(i.width);o.show()}function q(){o.hide()}function p(y){var z=y.suggests,x="",v=26,A;for(var w=0;w<z.length;w++){A=z[w];if(A&&A.length>v){A=A.substring(0,v)+"..."}x+=Ark.template(h,{suggest:A})}if(z.length>0){m(x)}else{q()}}k.focus(function(){l()});k.blur(function(){setTimeout(function(){q()},300)});k.keydown(g);k.keyup(e);c.on("submit",function(v){if(!k.val()){v.preventDefault()}})};$.suggests({url:"/j/suggest",param:"q",width:360,delay:200})})();